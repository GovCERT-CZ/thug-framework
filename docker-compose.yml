db:
  image: mongo:latest
  environment:
    - MONGO_PWD=mypass

redis:
  image: redis:latest
  environment:
    - REDIS_PWD=mypass

web:
  build: .
  dockerfile: Dockerfile.web
  entrypoint: ["/entrypoint.sh"]
  command: ["python", "app.py"]
  ports:
    - "5000:5000"
  links:
    - db:db
    - redis:redis

worker:
  build: .
  dockerfile: Dockerfile.worker
  entrypoint: ["/entrypoint.sh"]
  command: ["celery", "worker", "-l", "info", "-A", "worker.tasks"]
  links:
    - db:db
    - redis:redis

flower:
  build: .
  dockerfile: Dockerfile.worker
  entrypoint: ["/entrypoint.sh"]
  command: ["celery", "flower", "-A", "worker.tasks", "--address=0.0.0.0", "--port=5555"]
  ports:
    - "5555:5555"
  links:
    - db:db
    - redis:redis
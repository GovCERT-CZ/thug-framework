# image for webclient
FROM alpine:latest

RUN apk update && \
	apk upgrade && \
	apk add git && \
	apk add python && \
	apk add py-pip && \
	apk add bash

COPY ./webclient/entrypoint.sh /
COPY ./webclient /opt/project/webclient/
COPY ./worker /opt/project/worker/
COPY ./crawler /opt/project/crawler/
COPY ./config.json /opt/project/config.json

RUN cd /opt/project/webclient && \
    pip install -r requirements.txt

# IMPORT THUG WEB BROWSER PERSONALITIES
RUN git clone https://github.com/buffer/thug.git /tmp/thug && \
    cp /tmp/thug/thug/DOM/personalities/* /opt/project/webclient/api/models/personalities

ENV PYTHONPATH /opt/project/
WORKDIR /opt/project/webclient/
RUN adduser -D -g '' user
RUN chmod +x /entrypoint.sh

RUN apk del py-pip git
RUN rm -rf /var/cache/apk/*
RUN rm -rf /tmp/thug/*